# üì¶ Protocol Buffers (Protobuf)

## –ß—Ç–æ —Ç–∞–∫–æ–µ Protobuf

Protocol Buffers ‚Äî —ç—Ç–æ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π Google.

–ì–ª–∞–≤–Ω–∞—è –∏–¥–µ—è:

> –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—ã—Å—Ç—Ä–µ–µ –∏ –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ, —á–µ–º JSON.

Protobuf —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å:

- [[gRPC]]
    
- –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏
    
- –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ API
    

---

# üß† –ü–æ—á–µ–º—É –Ω–µ JSON?

JSON:

- —Ç–µ–∫—Å—Ç–æ–≤—ã–π
    
- —É–¥–æ–±–Ω—ã–π –¥–ª—è —á–µ–ª–æ–≤–µ–∫–∞
    
- –Ω–æ –±–æ–ª—å—à–æ–π –ø–æ —Ä–∞–∑–º–µ—Ä—É
    
- –º–µ–¥–ª–µ–Ω–Ω–µ–µ –ø–∞—Ä—Å–∏—Ç—Å—è
    

Protobuf:

- –±–∏–Ω–∞—Ä–Ω—ã–π
    
- –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π
    
- –±—ã—Å—Ç—Ä–µ–µ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è
    
- —Å—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω
    

---

# üß± –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Protobuf

–í–º–µ—Å—Ç–æ –ø–µ—Ä–µ–¥–∞—á–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ JSON, —Ç—ã —Å–Ω–∞—á–∞–ª–∞ –æ–ø–∏—Å—ã–≤–∞–µ—à—å –µ—ë –≤ `.proto` —Ñ–∞–π–ª–µ.

–ü—Ä–∏–º–µ—Ä:

syntax = "proto3";  
  
message User {  
  int32 id = 1;  
  string name = 2;  
  string email = 3;  
}

–≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è:

> Schema (—Å—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö)

---

# üî¢ –ß—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç –Ω–æ–º–µ—Ä–∞ –ø–æ–ª–µ–π

int32 id = 1;

–ß–∏—Å–ª–æ `1` ‚Äî —ç—Ç–æ –Ω–æ–º–µ—Ä –ø–æ–ª—è.

–í –±–∏–Ω–∞—Ä–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –¥–∞–Ω–Ω—ã–µ –∫–æ–¥–∏—Ä—É—é—Ç—Å—è –ø–æ –Ω–æ–º–µ—Ä—É, –∞ –Ω–µ –ø–æ –∏–º–µ–Ω–∏.

–≠—Ç–æ –¥–µ–ª–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º.

–í–∞–∂–Ω–æ:

> –ù–æ–º–µ—Ä –ø–æ–ª—è –Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å –ø–æ—Å–ª–µ –≤—ã–ø—É—Å–∫–∞ API.

---

# ‚öô –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞

–ò–∑ `.proto` —Ñ–∞–π–ª–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∫–æ–¥ –¥–ª—è –Ω—É–∂–Ω–æ–≥–æ —è–∑—ã–∫–∞.

–î–ª—è Go:

protoc --go_out=. user.proto

–°–æ–∑–¥–∞—ë—Ç—Å—è Go-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞.

---

# üß© –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ Go

–ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:

user := &pb.User{  
    Id:    1,  
    Name:  "Nazar",  
    Email: "test@mail.com",  
}

–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è:

data, err := proto.Marshal(user)

–î–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è:

var user pb.User  
err := proto.Unmarshal(data, &user)

---

# üöÄ Protobuf + gRPC

Protobuf —á–∞—â–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å [[gRPC]].

–í `.proto` –º–æ–∂–Ω–æ –æ–ø–∏—Å—ã–≤–∞—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –Ω–æ –∏ —Å–µ—Ä–≤–∏—Å—ã:

service UserService {  
  rpc GetUser(UserRequest) returns (UserResponse);  
}

–≠—Ç–æ —É–∂–µ:

- –æ–ø–∏—Å–∞–Ω–∏–µ API
    
- –∫–æ–Ω—Ç—Ä–∞–∫—Ç –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
    

---

# üì¶ –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –≤ Protobuf

- int32
    
- int64
    
- string
    
- bool
    
- bytes
    
- repeated (–º–∞—Å—Å–∏–≤)
    
- message (–≤–ª–æ–∂–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
    

–ü—Ä–∏–º–µ—Ä –º–∞—Å—Å–∏–≤–∞:

repeated string tags = 4;

---

# üîÑ JSON vs Protobuf

|JSON|Protobuf|
|---|---|
|–¢–µ–∫—Å—Ç|–ë–∏–Ω–∞—Ä–Ω—ã–π|
|–ß–∏—Ç–∞–µ–º—ã–π|–ù–µ —á–∏—Ç–∞–µ–º—ã–π|
|–ì–∏–±–∫–∏–π|–°—Ç—Ä–æ–≥–∞—è —Å—Ö–µ–º–∞|
|–ú–µ–¥–ª–µ–Ω–Ω–µ–µ|–ë—ã—Å—Ç—Ä–µ–µ|
|–ë–æ–ª—å—à–µ —Ä–∞–∑–º–µ—Ä|–ú–µ–Ω—å—à–µ —Ä–∞–∑–º–µ—Ä|

---

# üß† –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Protobuf

–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:

- –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤
    
- high-load —Å–∏—Å—Ç–µ–º
    
- –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –æ–±—â–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
    
- gRPC
    

–ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:

- –ø—É–±–ª–∏—á–Ω—ã—Ö API –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
    
- —Å–ª—É—á–∞–µ–≤, –≥–¥–µ –≤–∞–∂–Ω–∞ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å
    

---

# üîê –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

Protobuf –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã:

–ú–æ–∂–Ω–æ:

- –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è
    
- –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ
    

–ù–µ–ª—å–∑—è:

- –º–µ–Ω—è—Ç—å –Ω–æ–º–µ—Ä–∞ –ø–æ–ª–µ–π
    
- –º–µ–Ω—è—Ç—å —Ç–∏–ø —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—è
    

---

# üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ–º—ã

- [[gRPC]]
    
- [[JSON]]
    
- [[REST API]]
    
- [[TCP]]
    
- [[HTTP/2]]
    
- [[Serialization]]
    
- [[Schema]]
    

---

# üìå –ì–ª–∞–≤–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ

Protobuf ‚Äî —ç—Ç–æ:

> –°—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ –∑–∞—Ä–∞–Ω–µ–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å—Ö–µ–º–µ.

–û–Ω –Ω—É–∂–µ–Ω –¥–ª—è:

- —Å–∫–æ—Ä–æ—Å—Ç–∏
    
- –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏
    
- –Ω–∞–¥—ë–∂–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
    

---

# üíé –ò–Ω—Å–∞–π—Ç –¥–ª—è —Ç–µ–±—è

REST + JSON ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è —á–µ–ª–æ–≤–µ–∫–∞  
gRPC + Protobuf ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è –º–∞—à–∏–Ω

–≠—Ç–æ –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–∞ –∫ API.